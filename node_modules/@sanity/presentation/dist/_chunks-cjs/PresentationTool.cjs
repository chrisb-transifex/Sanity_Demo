"use strict";var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r),n=require("react/jsx-runtime"),r=require("@sanity/client/csm"),i=require("@sanity/ui"),s=require("react"),a=require("sanity"),o=require("sanity/router"),c=require("styled-components"),l=require("./index.cjs"),u=require("@sanity/icons"),d=require("sanity/structure"),p=require("./DisplayedDocumentBroadcaster.cjs"),f=require("@sanity/preview-url-secret/without-secret-search-params"),h=require("framer-motion"),m=require("@sanity/preview-url-secret/create-secret"),v=require("fast-deep-equal"),g=require("path-to-regexp"),y=require("@sanity/preview-url-secret/define-preview-url"),x=require("suspend-react");function b(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var w=b(v);let j;const P=new Uint8Array(16);function k(){if(!j&&(j=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!j))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return j(P)}const S=[];for(let e=0;e<256;++e)S.push((e+256).toString(16).slice(1));var E={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function C(e,t,n){if(E.randomUUID&&!t&&!e)return E.randomUUID();const r=(e=e||{}).random||(e.rng||k)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,t=0){return S[e[t+0]]+S[e[t+1]]+S[e[t+2]]+S[e[t+3]]+"-"+S[e[t+4]]+S[e[t+5]]+"-"+S[e[t+6]]+S[e[t+7]]+"-"+S[e[t+8]]+S[e[t+9]]+"-"+S[e[t+10]]+S[e[t+11]]+S[e[t+12]]+S[e[t+13]]+S[e[t+14]]+S[e[t+15]]}(r)}const I=1e3,T=1e3,R=500,L=["handshake/syn","handshake/syn-ack","handshake/ack"],_=e=>L.some((t=>t===e)),z=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function D(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(_(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),l(e,"handshake/ack",{id:e.id}))}}const s=t=>{var r,i,s;const a=t.data;if(!_(a.type)&&n.find((e=>e.id===a.connectionId))){const t=n.find((e=>e.config.id===a.from));if(t){const n=[a.type,a.data];null==(i=(r=t.config).onEvent)||i.call(r,...n),null==(s=e.onEvent)||s.call(e,...n),u(t,"channel/response",{responseTo:a.id},!1)}}};function a(t){var r;if(z(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;null==(r=n.find((t=>t.config.id===e.from)))||r.handler(t)}}function o(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){var a,c,d;t.status=n,null==(c=(a=t.config).onStatusUpdate)||c.call(a,n,t.config.id),null==(d=e.onStatusUpdate)||d.call(e,n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,o(t),function(e){e.id=C(),e.interval=window.setInterval((()=>{l(e,"handshake/syn",{id:e.id})}),R)}(t)):"connected"===n?(t.handler=s,r(t),function(e){if(o(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:T;e.heartbeat=window.setInterval((()=>{u(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{u(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),o(t))}function l(n,r,i){if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:C(),to:n.config.id,type:r};try{null==t||t.postMessage(s,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${s.id}' on '${e.id}'`)}}function u(n,r,i,s=!0){const a=C();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(s){const t=setTimeout((()=>{o.connectionId===n.id&&(window.removeEventListener("message",s,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${o.type}' on client '${e.id}' (ID: '${o.id}').`))}),I),s=e=>{var n;const{data:r}=e;"channel/response"===r.type&&null!=(n=r.data)&&n.responseTo&&r.data.responseTo===o.id&&(window.removeEventListener("message",s,!1),clearTimeout(t))};window.addEventListener("message",s,!1)}try{null==t||t.postMessage(o,{targetOrigin:e.targetOrigin})}catch{throw new Error(`Failed to postMessage '${o.id}' on client '${e.id}'`)}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(u(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{o(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");u(i,t,r)}))}}}var M,O,$,U;function A(e){var t,n,r;let i=typeof e;return"object"===i&&(i=null!=(r=e&&(null==(n=null==(t=Object.getPrototypeOf(e))?void 0:t.constructor)?void 0:n.name))?r:"null"),"string"===i?`"${e}"`:"number"===i||"bigint"===i||"boolean"===i?`${e}`:i}function F(e,t,n,r,i){var s,a,o,c,l,u;const d=i&&"input"in i?i.input:n.value,p=null!=(s=null==i?void 0:i.expected)?s:e.expects,f=null!=(a=null==i?void 0:i.received)?a:A(d),h={kind:e.kind,type:e.type,input:d,expected:p,received:f,message:`Invalid ${t}: ${p?`Expected ${p} but r`:"R"}eceived ${f}`,requirement:e.requirement,path:null==i?void 0:i.path,issues:null==i?void 0:i.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly,skipPipe:r.skipPipe},m="schema"===e.kind,v=null!=(u=null!=(l=null!=(c=null!=(o=e.message)?o:function(e,t){var n;return null==(n=null==U?void 0:U.get(e))?void 0:n.get(t)}(e.reference,h.lang))?c:m?(g=h.lang,null==$?void 0:$.get(g)):null)?l:r.message)?u:function(e){return null==O?void 0:O.get(e)}(h.lang);var g;v&&(h.message="function"==typeof v?v(h):v),m&&(n.typed=!1),n.issues?n.issues.push(h):n.issues=[h]}function B(e){return"__proto__"!==e&&"prototype"!==e&&"constructor"!==e}var W=class extends Error{constructor(e){super(e[0].message),t(this,"issues"),this.name="ValiError",this.issues=e}};function q(e,t,n){return"function"==typeof e.fallback?e.fallback(t,n):e.fallback}function N(e){return{kind:"schema",type:"boolean",reference:N,expects:"boolean",async:!1,message:e,_run(e,t){return"boolean"==typeof e.value?e.typed=!0:F(this,"type",e,t),e}}}function V(e,t){return{kind:"schema",type:"object",reference:V,expects:"Object",async:!1,entries:e,message:t,_run(e,t){var n;const r=e.value;if(r&&"object"==typeof r){e.typed=!0,e.value={};for(const i in this.entries){const s=r[i],a=this.entries[i]._run({typed:!1,value:s},t);if(a.issues){const o={type:"object",origin:"value",input:r,key:i,value:s};for(const t of a.issues)t.path?t.path.unshift(o):t.path=[o],null==(n=e.issues)||n.push(t);if(e.issues||(e.issues=a.issues),t.abortEarly){e.typed=!1;break}}a.typed||(e.typed=!1),(void 0!==a.value||i in r)&&(e.value[i]=a.value)}}else F(this,"type",e,t);return e}}}function K(e,...t){const n={kind:"schema",type:"optional",reference:K,expects:`${e.expects} | undefined`,async:!1,wrapped:e,_run(e,t){return void 0===e.value&&("default"in this&&(e.value=function(e,t,n){return"function"==typeof e.default?e.default(t,n):e.default}(this,e,t)),void 0===e.value)?(e.typed=!0,e):this.wrapped._run(e,t)}};return 0 in t&&(n.default=t[0]),n}function G(e){return{kind:"schema",type:"string",reference:G,expects:"string",async:!1,message:e,_run(e,t){return"string"==typeof e.value?e.typed=!0:F(this,"type",e,t),e}}}function J(e,t,n){const r=e._run({typed:!1,value:t},function(e){var t,n,r;return{lang:null!=(t=null==e?void 0:e.lang)?t:null==M?void 0:M.lang,message:null==e?void 0:e.message,abortEarly:null!=(n=null==e?void 0:e.abortEarly)?n:null==M?void 0:M.abortEarly,abortPipeEarly:null!=(r=null==e?void 0:e.abortPipeEarly)?r:null==M?void 0:M.abortPipeEarly,skipPipe:null==e?void 0:e.skipPipe}}(n));if(r.issues)throw new W(r.issues);return r.value}const H=/^([A-Za-z]+):([0-9]+)$/,X=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,Z=/^([A-Za-z]+):([a-z0-9]+)$/;const Q=function(...e){return{...e[0],pipe:e,_run(t,n){for(let r=0;r<e.length;r++){t=e[r]._run(t,n);const i=e[r+1];if(n.skipPipe||t.issues&&(n.abortEarly||n.abortPipeEarly||"schema"===(null==i?void 0:i.kind)||"transformation"===(null==i?void 0:i.kind))){t.typed=!1;break}}return t}}}(G(),function e(t,n){return{kind:"validation",type:"min_length",reference:e,async:!1,expects:`>=${t}`,requirement:t,message:n,_run(e,t){return e.typed&&e.value.length<this.requirement&&F(this,"length",e,t,{received:`${e.value.length}`}),e}}}(1)),Y=K(Q);function ee(e,t){return`${e}-${"string"==typeof t?t:JSON.stringify(t)}`}V({baseUrl:Q,dataset:Y,id:Q,path:Q,projectId:Y,tool:Y,type:Y,workspace:Y,isDraft:K(G())}),V({origin:Q,href:Q,data:K(function e(t,n,r){return{kind:"schema",type:"record",reference:e,expects:"Object",async:!1,key:t,value:n,message:r,_run(e,t){var n,r;const i=e.value;if(i&&"object"==typeof i){e.typed=!0,e.value={};for(const s in i)if(B(s)){const a=i[s],o=this.key._run({typed:!1,value:s},t);if(o.issues){const r={type:"record",origin:"key",input:i,key:s,value:a};for(const t of o.issues)t.path=[r],null==(n=e.issues)||n.push(t);if(e.issues||(e.issues=o.issues),t.abortEarly){e.typed=!1;break}}const c=this.value._run({typed:!1,value:a},t);if(c.issues){const n={type:"record",origin:"value",input:i,key:s,value:a};for(const t of c.issues)t.path?t.path.unshift(n):t.path=[n],null==(r=e.issues)||r.push(t);if(e.issues||(e.issues=c.issues),t.abortEarly){e.typed=!1;break}}(!o.typed||!c.typed)&&(e.typed=!1),o.typed&&(e.value[o.value]=c.value)}}else F(this,"type",e,t);return e}}}(G(),function e(){return{kind:"schema",type:"unknown",reference:e,expects:"unknown",async:!1,_run:e=>(e.typed=!0,e)}}()))});const te={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function ne(e){return"Alt"===e.key}function re(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const ie=s.createContext(null);ie.displayName="PanelsContext";const se=c.styled.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,ae=function({children:e,defaultSize:t=null,id:r,minWidth:i,maxWidth:a,order:o=0}){const c=s.useContext(ie);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:u,unregisterElement:d}=c,p=l(r);return s.useLayoutEffect((()=>(u(r,{id:r,type:"panel",defaultSize:t,maxWidth:null!=a?a:null,minWidth:null!=i?i:0,order:o}),()=>{d(r)})),[r,t,o,a,i,u,d]),n.jsx(se,{style:p,children:e})},oe="presentation/panels",ce=()=>JSON.parse(localStorage.getItem(oe)||"{}"),le=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function ue(){return s.useMemo((()=>{const e=(e,t)=>{const n=ce(),r=le(e);(e=>{localStorage.setItem(oe,JSON.stringify(e))})({...n,[r]:t})};return{get:e=>{const t=ce(),n=le(e);return Array.isArray(t[n])&&t[n].some((e=>null===e))?void 0:t[n]},set:e,setDebounced:re(e,100)}}),[])}function de(e,t,n){const{maxWidth:r,minWidth:i}=e,s=null==r?100:r/n*100,a=i/n*100;return Math.min(s,Math.max(a,t))}function pe(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function fe(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function he(e){return"panel"===e.type}function me(e){return"resizer"===e.type}function ve(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function ge(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let s=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],o=de(r,a,n);a!=o&&(s+=a-o,i[t]=o)}if("0.000"!==s.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:o}=r;o=o/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(o,i[t]+s));if(c!==i[t]&&(s-=c-i[t],i[t]=c,"0.000"===Math.abs(s).toFixed(3)))break}return i}const ye=c.styled.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,xe=function({children:e}){const t=s.useRef(null),[r,i]=s.useState(new Map),a=s.useMemo((()=>ve(r).filter(he)),[r]),[o,c]=s.useState([]),[l,u]=s.useState(null),d=s.useRef({elements:r,panels:a,widths:o}),p=s.useCallback((e=>({flexGrow:pe(a,e,o),pointerEvents:null===l?void 0:"none"})),[l,a,o]),f=s.useCallback(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=s.useCallback((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=s.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=s.useCallback(((e,t)=>{const n=ve(r),i=n.findIndex((t=>t.id===e)),s=r.get(e);if(!s||!me(s))return;const a=s.el.current;a&&(m.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>he(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&he(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:fe(t,a),resizerRect:a.getBoundingClientRect(),widths:d.current.widths},u(e))}),[r]),g=s.useCallback((()=>{u(null)}),[]),y=s.useCallback(((e,n)=>{n.preventDefault(),n.stopPropagation();const{containerWidth:i,dragOffset:s,panelBefore:a,panelAfter:o,resizerRect:l}=m.current;if(null==a||null==o)return;const u=r.get(e);if(!u||!me(u))return;const p=u.el.current;if(!p)return;const f=fe(n,p,s,l);if(0===f)return;const{widths:h}=d.current,v=function(e,t,n,r,i,s){const{panels:a,widths:o}=i,{widths:c}=s,l=c||o,u=[...l];{const i=e<0?r:n,s=l[a.findIndex((e=>e.id===i.id))],o=de(i,s+Math.abs(e),t);if(s===o)return l;e=e<0?s-o:o-s}let d=0,p=e<0?n:r,f=a.findIndex((e=>e.id===p.id));for(;;){const n=a[f],r=l[f],i=de(n,r-(Math.abs(e)-Math.abs(d)),t);if(r!==i&&(d+=r-i,u[f]=i,d.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=a.length)break}return 0===d?l:(p=e<0?r:n,f=a.findIndex((e=>e.id===p.id)),u[f]=l[f]+d,u)}(f/t.current.getBoundingClientRect().width*100,i,a,o,d.current,m.current);h.some(((e,t)=>e!==v[t]))&&c(v)}),[r]);s.useLayoutEffect((()=>{d.current.elements=r,d.current.panels=a,d.current.widths=o}),[r,a,o]);const x=ue();s.useLayoutEffect((()=>{const{widths:e}=d.current;if(e.length===a.length)return;const t=x.get(a);if(t){const e=ge(a,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(a);c(n)}),[x,a]),s.useEffect((()=>{o.length&&x.setDebounced(a,o)}),[x,a,o]),s.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=d.current,n=ge(e,t,window.innerWidth);t.some(((e,t)=>e!==n[t]))&&c(n)}));return e.observe(t.current),()=>{e.disconnect()}}),[]);const b=s.useMemo((()=>({activeResizer:l,drag:y,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:h})),[l,y,p,f,v,g,h]);return n.jsx(ie.Provider,{value:b,children:n.jsx(ye,{ref:t,children:e})})};function be(e){const{children:t,message:r,onRetry:s,onContinueAnyway:o,...c}=e,{t:u}=a.useTranslation(l.p),d=n.jsx(i.Button,{fontSize:1,mode:"ghost",onClick:s,text:u("error-card.retry-button.text")}),p=n.jsx(i.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:o,text:u("error-card.continue-button.text")});return n.jsx(i.Card,{height:"fill",...c,children:n.jsx(i.Flex,{align:"center",height:"fill",justify:"center",children:n.jsx(i.Container,{padding:4,sizing:"border",width:0,children:n.jsxs(i.Stack,{space:4,children:[n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Text,{size:1,weight:"semibold",children:u("error-card.title")}),n.jsx(i.Text,{muted:!0,size:1,children:r})]}),t,s&&o?n.jsxs(i.Inline,{space:2,children:[d,p]}):s?n.jsx(i.Box,{children:d}):o?n.jsx(i.Box,{children:p}):null]})})})})}function we(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","prefersLatestPublished","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const je=s.forwardRef((function(e,t){const{searchParams:r,...i}=e;return n.jsx(o.StateLink,{...i,ref:t,state:{type:void 0,_searchParams:Object.entries(r)},title:void 0})})),Pe=s.forwardRef((function(e,t){const{documentId:r,documentType:i,parentRefPath:s,template:a,searchParams:c,...l}=e;return n.jsx(o.StateLink,{...l,ref:t,state:{id:r,type:i,_searchParams:Object.entries({...c,prefersLatestPublished:"published"===c.perspective?"true":void 0})},title:void 0})}));function ke(e){const{children:t,onStructureParams:r,structureParams:i,searchParams:c,refs:l}=e,{state:u,resolvePathFromState:p}=o.useRouter(),f=a.useUnique(Object.fromEntries(u._searchParams||[])),h=s.useCallback((e=>`${p(u)}${we({...f,...e})}`),[p,f,u]),m=s.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:e=>{const{childId:t,...r}=e,i=null==l?void 0:l.find((e=>e._id===t||a.getPublishedId(e._id)===t));return i?n.jsx(o.StateLink,{...r,state:{id:t,type:i._type,_searchParams:Object.entries({...c,prefersLatestPublished:"published"===(null==c?void 0:c.perspective)?"true":void 0})}}):n.jsx("div",{...r})},BackLink:e=>n.jsx(je,{...e,searchParams:c}),ReferenceChildLink:e=>n.jsx(Pe,{...e,searchParams:c}),ParameterizedLink:()=>n.jsx(n.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{var t;r({...e,inspect:null!=(t=e.inspect)?t:void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:h})),[h,r,l,c,i]);return n.jsx(d.PaneRouterContext.Provider,{value:m,children:t})}const Se=c.styled(d.PaneLayout)`
  height: 100%;
`,Ee=c.styled(i.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,Ce=c.styled(i.Code)`
  white-space: pre-wrap;
`;function Ie(e){const{mainDocumentState:t,onStructureParams:r,searchParams:o,refs:c}=e,{t:u}=a.useTranslation(l.p),{devMode:p}=l.u(),f=s.useMemo((()=>c.filter((e=>{var n;return a.getPublishedId(e._id)!==(null==(n=null==t?void 0:t.document)?void 0:n._id)})).map((e=>e._id))),[t,c]),h=s.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:f}},schemaTypeName:"",title:u("document-list-pane.document-list.title"),type:"documentList"})),[f,u]),[m,v]=s.useState(null),g=s.useCallback((()=>v(null)),[]),[y]=s.useState((()=>({})));return s.useEffect((()=>v(null)),[c]),m?n.jsx(be,{flex:1,message:u("document-list-pane.error.text"),onRetry:g,children:p&&n.jsx(i.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:u("presentation-error.label")}),n.jsx(Ce,{size:1,children:m.error.message})]})})}):n.jsx(i.ErrorBoundary,{onCatch:v,children:n.jsx(Se,{children:n.jsx(d.StructureToolProvider,{children:n.jsx(ke,{onStructureParams:r,structureParams:y,searchParams:o,refs:c,children:n.jsx(Ee,{direction:"column",flex:1,children:n.jsx(d.DocumentListPane,{index:0,itemId:"$root",pane:h,paneKey:"$root"})})})})})})}const Te=c.styled(i.Code)`
  white-space: pre-wrap;
`;function Re(e){const{documentId:t,documentType:r,onFocusPath:c,onStructureParams:u,searchParams:p,structureParams:f}=e,{template:h,templateParams:m}=f,{t:v}=a.useTranslation(l.p),{devMode:g}=l.u(),y=s.useMemo((()=>({id:t,options:{id:t,type:r,template:h,templateParameters:o.decodeJsonParams(m)},title:"",type:"document"})),[t,r,h,m]),[x,b]=s.useState(null),w=s.useCallback((()=>b(null)),[]);return s.useEffect((()=>{b(null)}),[t,r,f]),x?n.jsx(be,{flex:1,message:v("document-pane.error.text"),onRetry:w,children:g&&n.jsx(i.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:v("presentation-error.label")}),n.jsx(Te,{size:1,children:x.error.message})]})})}):n.jsx(i.ErrorBoundary,{onCatch:b,children:n.jsx(d.PaneLayout,{style:{height:"100%"},children:n.jsx(ke,{searchParams:p,onStructureParams:u,structureParams:f,children:n.jsx(d.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:y,onFocusPath:c})})})})}function Le(e){const{documentId:t,documentType:r,onFocusPath:i,onStructureParams:s,searchParams:a,structureParams:o}=e;return n.jsx(d.StructureToolProvider,{children:n.jsx(Re,{documentId:t,documentType:r,onFocusPath:i,onStructureParams:s,searchParams:a,structureParams:o})})}function _e(e){var t;const{documentId:r,documentType:c,mainDocumentState:d,onFocusPath:p,onStructureParams:f,refs:h,searchParams:m,structureParams:v}=e,{t:g}=a.useTranslation(l.p),y=a.useSchema(),x=s.useCallback((e=>n.jsx(o.StateLink,{...e,state:{id:d.document._id,type:d.document._type,_searchParams:Object.entries({...m,prefersLatestPublished:"published"===(null==m?void 0:m.perspective)?"true":void 0})}})),[d,m]),b=s.useMemo((()=>{var e;return y.get((null==(e=null==d?void 0:d.document)?void 0:e._type)||"shoe")}),[d,y]),w=function(e,t){const n=a.useDocumentPreviewStore(),[r,i]=s.useState({});return s.useEffect((()=>{if(!t)return;const r=a.getPreviewStateObservable(n,t,e,"").subscribe((e=>{i(e)}));return()=>{null==r||r.unsubscribe()}}),[n,t,e]),r}((null==(t=null==d?void 0:d.document)?void 0:t._id)||"",b),j=s.useMemo((()=>d?n.jsx(a.SanityDefaultPreview,{...a.getPreviewValueWithFallback({value:d.document,published:w.published,draft:w.draft}),schemaType:b,status:n.jsx(i.Card,{padding:1,radius:2,shadow:1,children:n.jsx(i.Text,{muted:!0,size:0,weight:"medium",children:g("main-document.label")})})}):null),[d,b,g,w]);return r&&c?n.jsx(Le,{documentId:r,documentType:c,onFocusPath:p,onStructureParams:f,searchParams:m,structureParams:v}):n.jsxs(i.Flex,{direction:"column",flex:1,height:"fill",children:[d&&n.jsx(i.Card,{padding:3,tone:d.document?"inherit":"caution",children:d.document?n.jsx(a.PreviewCard,{__unstable_focusRing:!0,as:x,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:j}):n.jsx(i.Card,{padding:2,radius:2,tone:"inherit",children:n.jsxs(i.Flex,{gap:3,children:[n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{size:1,children:n.jsx(u.WarningOutlineIcon,{})})}),n.jsx(i.Box,{flex:1,children:n.jsx(i.Text,{size:1,children:n.jsx(a.Translate,{t:g,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:d.path}})})})]})})}),n.jsx(Ie,{mainDocumentState:d,onStructureParams:f,searchParams:m,refs:h})]})}const ze=c.styled.div`
  position: relative;
`,De=c.styled.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Me=function({id:e,order:t,disabled:r=!1}){const i=s.useRef(null),a=s.useContext(ie);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const o=function(e){return s.useRef(e||C()).current}(e),{activeResizer:c,drag:l,startDragging:u,stopDragging:d,registerElement:p,unregisterElement:f}=a,h=c===o;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=s.useCallback((e=>{u(o,e.nativeEvent)}),[o,u]),v=s.useCallback((e=>{l(o,e)}),[o,l]),g=s.useCallback((()=>{i.current.blur(),d()}),[d]);return s.useEffect((()=>{if(h&&!r)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[r,h,v,g]),s.useLayoutEffect((()=>(p(o,{id:o,order:t,type:"resizer",el:i}),()=>{f(o)})),[o,t,p,f]),n.jsx(ze,{onMouseDown:m,ref:i,children:n.jsxs(De,{$disabled:r,children:[n.jsx("span",{}),n.jsx("span",{})]})})},Oe=e=>{const{documentId:t,setDisplayedDocument:r,getCommentIntent:i}=e;return n.jsxs(n.Fragment,{children:[n.jsx(Me,{order:4}),n.jsx(ae,{id:"content",minWidth:325,order:5,children:n.jsx(p.D,{documentId:t,setDisplayedDocument:r,children:n.jsx(a.CommentsIntentProvider,{getIntent:i,children:e.children})})})]})},$e=e=>{const{documentId:t,documentsOnPage:r,documentType:i,getCommentIntent:s,mainDocumentState:a,onFocusPath:o,onStructureParams:c,searchParams:l,setDisplayedDocument:u,structureParams:d}=e;return n.jsx(Oe,{documentId:t,getCommentIntent:s,setDisplayedDocument:u,children:n.jsx(_e,{documentId:t,documentType:i,mainDocumentState:a,onFocusPath:o,onStructureParams:c,refs:r,searchParams:l,structureParams:d})})},Ue=function(e){const{children:t,navigate:r}=e,i=s.useCallback(((e,t=void 0)=>{r(t||{},e?{preview:e}:{})}),[r]);return n.jsx(l.P.Provider,{value:i,children:t})};function Ae(e){const{unstable_navigator:t}=e,r=!(null==t||!t.component),[i,a]=function(e,t){const[n,r]=s.useState((()=>{var n;return JSON.parse(null!=(n=localStorage.getItem(e))?n:JSON.stringify(t))}));return s.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",r),o=!!r&&i,c=s.useMemo((()=>{if(r)return()=>a((e=>!e))}),[r,a]),l=s.useCallback((function(){return n.jsx(n.Fragment,{children:o&&n.jsx(Fe,{...t})})}),[o,t]);return[{navigatorEnabled:o,toggleNavigator:c},l]}const Fe=s.memo((function(e){const{minWidth:t,maxWidth:r,component:i}=e,s=null!=t&&null!=r&&t===r;return n.jsxs(n.Fragment,{children:[n.jsx(ae,{id:"navigator",minWidth:t,maxWidth:r,order:1,children:n.jsx(i,{})}),n.jsx(Me,{order:2,disabled:s})]})})),Be=function(e){const{children:t,params:r}=e,i=s.useMemo((()=>r),[r]);return n.jsx(l.a.Provider,{value:i,children:t})},We=function(e){const{children:t,devMode:r,name:i,navigate:a,params:o,searchParams:c,structureParams:u}=e,d=s.useMemo((()=>({devMode:r,name:i,navigate:a,params:o,searchParams:c,structureParams:u})),[r,i,a,o,c,u]);return n.jsx(l.b.Provider,{value:d,children:t})},qe="ACTION_IFRAME_LOADED",Ne="ACTION_IFRAME_REFRESH",Ve="ACTION_IFRAME_RELOAD",Ke="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",Ge=(e,t)=>{switch(t.type){case qe:return"loaded"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"loaded"}};case Ne:return"refreshing"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case Ve:return"reloading"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"reloading"}};case Ke:return Je(e,t);default:return e}},Je=(e,t)=>e.visualEditing.overlaysEnabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:t.enabled}},He=(Ye=N(),et=!1,{...Ye,fallback:et,_run(e,t){return Ye._run(e,t),e.issues?{typed:!0,value:q(this,e,t)}:e}}),Xe=function e(t,n){return{kind:"schema",type:"picklist",reference:e,expects:t.map(A).join(" | ")||"never",async:!1,options:t,message:n,_run(e,t){return this.options.includes(e.value)?e.typed=!0:F(this,"type",e,t),e}}}(["loading","loaded","refreshing","reloading"]),Ze=V({mainDocument:He,iframe:V({status:Xe}),visualEditing:V({overlaysEnabled:N()})}),Qe={mainDocument:!1,iframe:{status:"loading"},visualEditing:{overlaysEnabled:!1}};var Ye,et;function tt(e){return J(Ze,{...Qe,...e})}const nt=h.motion(c.styled.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),rt=function(e){var t;const{fontSize:r=1,onChange:o,origin:c,padding:d=3,prefix:p,suffix:f,value:h}=e,{t:m}=a.useTranslation(l.p),{basePath:v="/"}=(null==(t=a.useActiveWorkspace())?void 0:t.activeWorkspace)||{},g=s.useRef(null),[y,x]=s.useState(void 0),[b,w]=s.useState(void 0),j=s.useCallback((e=>{x(e.currentTarget.value)}),[]),P=s.useCallback((e=>{var t;if("Enter"===e.key){if(void 0===y)return;const e=y.startsWith("/")||""===y?`${c}${y}`:y;if(!e.startsWith(c+"/")&&e!==c)return void w(m("preview-location-input.error",{origin:c,context:"missing-origin"}));if(!c&&(e.startsWith(`${v}/`)||e===v))return void w(m("preview-location-input.error",{basePath:v,context:"same-base-path"}));const n=e===c?c+"/":e;w(void 0),x(void 0),o(n.slice(c.length)),null==(t=g.current)||t.blur()}"Escape"===e.key&&(w(void 0),x(void 0))}),[v,o,c,y,m]),k=s.useCallback((()=>{w(void 0),x(void 0)}),[]);s.useEffect((()=>{w(void 0),x(void 0)}),[c,h]);const S=s.useMemo((()=>({icon:u.ResetIcon})),[]);return n.jsx(n.Fragment,{children:n.jsx(i.TextInput,{clearButton:b?S:void 0,customValidity:b,fontSize:r,onBlur:k,onClear:()=>{w(void 0),x(c+h)},onChange:j,onKeyDownCapture:P,padding:d,prefix:p,style:{zIndex:1},radius:2,ref:g,space:d,suffix:f,value:void 0===y?`${c}${h}`:y})})};function it(e){const{initialUrl:t,openPopup:r,previewLocationOrigin:o,previewLocationRoute:c}=e,{t:d}=a.useTranslation(l.p),p=s.useCallback((e=>{e.preventDefault(),r(e.currentTarget.href)}),[r]);return n.jsxs(n.Fragment,{children:[n.jsx(st,{initialUrl:t,previewLocationOrigin:o,previewLocationRoute:c}),n.jsx(i.MenuItem,{icon:u.LaunchIcon,text:d("share-url.menu-item.open.text"),as:"a",href:`${o}${c}`,onClick:p,rel:"opener",target:"_blank"})]})}function st(e){const{initialUrl:t,previewLocationOrigin:r,previewLocationRoute:o}=e,{t:c}=a.useTranslation(l.p),{push:d}=i.useToast(),p=a.useClient({apiVersion:l.A}),h=a.useCurrentUser(),[v,g]=s.useState(!1);return n.jsx(i.MenuItem,{disabled:v,onClick:()=>{if(null==navigator||!navigator.clipboard)return d({closable:!0,status:"error",title:c("share-url.clipboard.status",{context:"unsupported"})}),!1;let e;g(!0);const n=`${r}${o}`,i=()=>{d({id:e,closable:!0,status:"success",title:c("share-url.clipboard.status",{context:"success"})}),g(!1)},s=e=>{d({closable:!0,status:"error",title:c("share-url.clipboard.status",{context:"failed"}),description:e.message||e.toString()}),g(!1)};if(f.hasSecretSearchParams(t)){const n=async()=>{e=d({closable:!0,title:c("share-url.clipboard.status",{context:"copying"})});const n=await m.createPreviewSecret(p,"@sanity/presentation",typeof window>"u"?"":location.href,null==h?void 0:h.id);return f.setSecretSearchParams(t,n.secret,o).toString()};if(typeof ClipboardItem<"u"){const e="text/plain",t=new ClipboardItem({[e]:n().then((t=>new Blob([t],{type:e})))});navigator.clipboard.write([t]).then(i).catch(s)}else n().then((e=>navigator.clipboard.writeText(e))).then(i).catch(s)}else navigator.clipboard.writeText(n).then(i).catch(s)},text:c("share-url.menu-item.copy.text"),icon:u.CopyIcon})}const at=h.motion(i.Flex),ot={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},ct="caution",lt="positive",ut={previewDrafts:u.EditIcon,published:u.PublishIcon},dt=s.forwardRef((function(e,t){const{dispatch:r,iframe:o,initialUrl:c,loadersConnection:d,navigatorEnabled:p,onPathChange:m,onRefresh:v,openPopup:g,overlaysConnection:y,perspective:x,previewUrl:b,setPerspective:w,setViewport:j,targetOrigin:P,toggleNavigator:k,toggleOverlay:S,viewport:E,visualEditing:{overlaysEnabled:C}}=e,{t:I}=a.useTranslation(l.p),{devMode:T}=l.u(),R=i.usePrefersReducedMotion(),L=s.useCallback((()=>j("desktop"===E?"mobile":"desktop")),[j,E]),_="loading"===o.status||"reloading"===o.status,[z,D]=s.useState(!1),M="refreshing"===o.status,[O,$]=s.useState(!1),U=_||M||"connecting"===y,A=s.useMemo((()=>P===location.origin?"":P),[P]),F=s.useCallback((()=>{v((()=>{"function"==typeof t||null==t||!t.current||(r({type:Ve}),t.current.src=`${P}${b||"/"}`)}))}),[r,v,b,P,t]),B=s.useCallback((()=>{"function"==typeof t||null==t||!t.current||(t.current.src=c.toString(),r({type:Ve}))}),[r,t,c]),W=s.useCallback((()=>{N(!0)}),[]),[q,N]=s.useState(!1),[V,K]=s.useState(!1);s.useEffect((()=>{if(!(_||M||"connecting"!==y&&"reconnecting"!==y)){const e=setTimeout((()=>{K(!0)}),1e3);return()=>clearTimeout(e)}}),[y,_,M]),s.useEffect((()=>{if(!_&&!M&&V){if("connected"===y&&($(!1),K(!1),D(!1),N(!1)),"connecting"===y){const e=setTimeout((()=>{D(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")}),l.M);return()=>clearTimeout(e)}if("reconnecting"===y){const e=setTimeout((()=>{D(!0),$(!0)}),l.M);return()=>clearTimeout(e)}"disconnected"===y&&$(!0)}}),[_,y,M,V]);const G=s.useMemo((()=>{const e=new URL(b||"/",P),{pathname:t,search:n}=f.withoutSecretSearchParams(e);return`${t}${n}`}),[b,P]),J=s.useCallback((()=>{r({type:qe})}),[r]);return s.useEffect((()=>{if("function"==typeof t||null==t||!t.current)return;const e=t.current;function n(){e===document.activeElement&&e.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",n),()=>{window.removeEventListener("blur",n)}}),[t]),n.jsx(h.MotionConfig,{transition:R?{duration:0}:void 0,children:n.jsxs(i.TooltipDelayGroupProvider,{delay:1e3,children:[n.jsx(i.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:n.jsxs(i.Flex,{align:"center",style:{minHeight:0},children:[k&&n.jsx(i.Box,{flex:"none",marginRight:1,padding:1,children:n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:I("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":I("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:u.PanelLeftIcon,mode:"bleed",onClick:k,padding:2,selected:p})})}),n.jsx(i.Tooltip,{animate:!0,content:n.jsxs(i.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[n.jsx(i.Box,{padding:1,children:n.jsx(i.Text,{size:1,children:I("preview-frame.overlay.toggle-button.tooltip",{context:C?"disable":"enable"})})}),n.jsx(i.Box,{paddingY:1,children:n.jsx(a.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:n.jsx(i.Card,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:C?"transparent":void 0,children:n.jsxs(i.Flex,{align:"center",gap:3,children:[n.jsx("div",{style:{margin:-4},children:n.jsx(i.Switch,{checked:C,onChange:S,disabled:"loading"===o.status||"connected"!==y})}),n.jsx(i.Box,{children:n.jsx(i.Text,{muted:!C,size:1,weight:"medium",children:I("preview-frame.overlay.toggle-button.text")})})]})})}),n.jsx(i.Box,{flex:1,marginX:1,children:n.jsx(rt,{prefix:n.jsx(i.Box,{padding:1,children:n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:"loaded"===o.status?I("preview-frame.refresh-button.tooltip"):I("preview-frame.status",{context:o.status})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":I("preview-frame.refresh-button.aria-label"),fontSize:1,icon:u.RefreshIcon,mode:"bleed",loading:"reloading"===o.status||"refreshing"===o.status,onClick:F,padding:2})})}),onChange:m,origin:A,suffix:n.jsx(i.Box,{padding:1,children:n.jsx(i.MenuButton,{button:n.jsx(i.Button,{fontSize:1,iconRight:u.ShareIcon,mode:"bleed",padding:2,space:2}),id:"location-menu",menu:n.jsx(i.Menu,{children:n.jsx(it,{initialUrl:c,openPopup:g,previewLocationOrigin:A,previewLocationRoute:G})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),value:G})}),n.jsx(i.Flex,{align:"center",flex:"none",gap:1,padding:1,children:n.jsx(i.MenuButton,{button:n.jsx(i.Button,{fontSize:1,iconRight:u.ChevronDownIcon,mode:"bleed",padding:2,space:2,text:I(ot["connected"===d?x:"previewDrafts"]),loading:"reconnecting"===d&&"loaded"!==o.status,disabled:"connected"!==d}),id:"perspective-menu",menu:n.jsxs(i.Menu,{style:{maxWidth:240},children:[n.jsx(i.MenuItem,{fontSize:1,onClick:()=>w("previewDrafts"),padding:3,pressed:"previewDrafts"===x,tone:ct,children:n.jsxs(i.Flex,{align:"flex-start",gap:3,children:[n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{size:1,children:s.createElement(ut.previewDrafts)})}),n.jsxs(i.Stack,{flex:1,space:2,children:[n.jsx(i.Text,{size:1,weight:"medium",children:I(ot.previewDrafts)}),n.jsx(i.Text,{muted:!0,size:1,children:I("preview-frame.perspective.previewDrafts.text")})]}),n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===x?1:0},children:n.jsx(u.CheckmarkIcon,{})})})]})}),n.jsx(i.MenuItem,{fontSize:1,onClick:()=>w("published"),padding:3,pressed:"published"===x,tone:lt,children:n.jsxs(i.Flex,{align:"flex-start",gap:3,children:[n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{size:1,children:s.createElement(ut.published)})}),n.jsxs(i.Stack,{flex:1,space:2,children:[n.jsx(i.Text,{size:1,weight:"medium",children:I(ot.published)}),n.jsx(i.Text,{muted:!0,size:1,children:I("preview-frame.perspective.published.text")})]}),n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{muted:!0,size:1,style:{opacity:"published"===x?1:0},children:n.jsx(u.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),n.jsx(i.Flex,{align:"center",flex:"none",gap:1,children:n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:I("preview-frame.viewport-button.tooltip",{context:"desktop"===E?"narrow":"full"})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":I("preview-frame.viewport-button.aria-label"),fontSize:1,icon:"desktop"===E?u.MobileDeviceIcon:u.DesktopIcon,mode:"bleed",onClick:L,padding:2})})})]})}),n.jsx(i.Card,{flex:1,tone:"transparent",children:n.jsxs(i.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===E?0:2,sizing:"border",style:{position:"relative",cursor:U?"wait":void 0},children:[n.jsx(h.AnimatePresence,{children:O||_||M||!V||q?(_||"connecting"===y&&"refreshing"!==o.status)&&!q?n.jsx(at,{initial:"initial",animate:"animate",exit:"exit",variants:ft,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:n.jsxs(i.Flex,{style:{...pt[E]},justify:"center",align:"center",direction:"column",gap:4,children:[n.jsx(i.Spinner,{muted:!0}),n.jsx(i.Text,{muted:!0,size:1,children:I("preview-frame.status",{context:"loading"})})]})}):O&&!q?n.jsx(at,{initial:"initial",animate:"animate",exit:"exit",variants:ht,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:n.jsx(be,{flex:1,message:I("preview-frame.connection.error.text"),onRetry:B,onContinueAnyway:W,children:T&&n.jsxs(n.Fragment,{children:["connected"!==y&&n.jsx(i.Card,{padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:I("preview-frame.overlay.connection-status.label")}),n.jsx(i.Code,{size:1,children:I("channel.status",{context:y})})]})}),"connected"!==d&&n.jsx(i.Card,{padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:I("preview-frame.loader.connection-status.label")}),n.jsx(i.Code,{size:1,children:I("channel.status",{context:d})})]})})]})})}):null:n.jsx(at,{initial:"initial",animate:"animate",exit:"exit",variants:ft,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:n.jsxs(i.Flex,{style:{...pt[E]},justify:"center",align:"center",direction:"column",gap:4,children:[z&&n.jsx(i.Button,{disabled:!0,fontSize:1,mode:"ghost",text:I("preview-frame.continue-button.text"),style:{opacity:0}}),n.jsx(i.Card,{radius:2,tone:z?"caution":"inherit",padding:4,shadow:1,children:n.jsxs(i.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[n.jsx(i.Spinner,{muted:!0}),n.jsx(i.Text,{muted:!0,size:1,children:I("preview-frame.status",z?{context:"timeout"}:{context:"connecting"})})]})}),z&&n.jsx(i.Button,{fontSize:1,tone:"critical",onClick:W,text:I("preview-frame.continue-button.text")})]})})}),n.jsx(nt,{ref:t,style:{pointerEvents:(_||"connecting"===y&&"refreshing"!==o.status)&&!q?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:c.toString(),initial:["background"],variants:mt,animate:[(_||"connecting"===y&&"refreshing"!==o.status)&&!q?"background":"active",_?"reloading":"idle",E,V&&!q?"timedOut":""],onLoad:J})]})})]})})})),pt={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},ft={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},ht={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},mt={desktop:{...pt.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...pt.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};let vt=!1;function gt(e,t){return e instanceof Function?e(t):e}function yt(e,t){const n=Array.isArray(e)?e:[e];for(e of n){let n,r=e;if("string"==typeof e)try{const t=new URL(e);n=t.origin,r=t.pathname}catch{}if(!n||t.origin===n)try{const e=g.match(r,{decode:decodeURIComponent})(t.pathname);if(e){const{params:t,path:r}=e;return{origin:n,params:t,path:r}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function xt(e){const{navigate:t,resolvers:n=[],path:r,previewUrl:i}=e,{state:c}=o.useRouter(),u=a.useClient({apiVersion:l.A}),[d,p]=s.useState(void 0),f=s.useRef(void 0),h=s.useMemo((()=>{var e,t;const n=r||(null==(t=null==(e=c._searchParams)?void 0:e.find((([e])=>"preview"===e)))?void 0:t[1])||"",s="string"==typeof i?i:"object"==typeof i&&(null==i?void 0:i.origin)||location.origin;return new URL(n,s)}),[r,i,c._searchParams]),m=s.useCallback((()=>{p(void 0),f.current=void 0}),[]);return s.useEffect((()=>{if(n.length&&h){let o;for(const e of n){const t=yt(e.route,h);if(t){o={context:t,resolver:e};break}}if(o){const n=function(e,t){var n;if(e.resolve){const r=null==(n=e.resolve(t))?void 0:n.filter;return r?`*[${r}][0]{_id, _type}`:void 0}return"type"in e?`*[_type == "${e.type}"][0]{_id, _type}`:`*[${gt(e.filter,t)}][0]{_id, _type}`}(o.resolver,o.context),c=(e=o.resolver,r=o.context,e.resolve?null!=(s=null==(i=e.resolve(r))?void 0:i.params)?s:r.params:"type"in e?{}:null!=(a=gt(e.params,r))?a:r.params);if(n){const e=new AbortController,r={perspective:"previewDrafts",signal:e.signal};return u.fetch(n,c,r).then((e=>{(!e||f.current!==e._id)&&(p({document:e,path:h.pathname}),null==t||t({id:null==e?void 0:e._id,type:null==e?void 0:e._type}),f.current=null==e?void 0:e._id)})).catch((e=>{e instanceof Error&&"AbortError"===e.name||(p({document:void 0,path:h.pathname}),f.current=void 0)})),()=>{e.abort()}}}}var e,r,i,s,a;m()}),[u,m,t,n,h]),d}function bt(e){var t;if(void 0===e)return;const n=null==(t=decodeURIComponent(e))?void 0:t.split(".");return"drafts"===n[0]&&n.shift(),n.join(".")}function wt(e){if(void 0!==e)return r.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=H.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=X.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=Z.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function jt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function Pt({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,frameStateRef:i}){const o=s.useMemo((()=>{const{id:t,path:i,type:s}={id:bt((a=n).id),path:wt(a.path),type:a.type};var a;return{id:t,type:s,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,prefersLatestPublished:r.prefersLatestPublished,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}}),[n,r,e]),c=s.useMemo((()=>jt({inspect:o.inspect,path:o.path,rev:o.rev,prefersLatestPublished:o.prefersLatestPublished,since:o.since,template:o.template,templateParams:o.templateParams,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.comment,o.inspect,o.instruction,o.path,o.pathKey,o.prefersLatestPublished,o.rev,o.since,o.template,o.templateParams,o.view]),l=s.useMemo((()=>jt({perspective:o.perspective,preview:o.preview,viewport:o.viewport})),[o.perspective,o.preview,o.viewport]),u=s.useRef(n);return s.useEffect((()=>{u.current=n}),[n]),{navigate:s.useCallback(((e,n={},r)=>{e.id&&(e.id=a.getPublishedId(e.id));const{_searchParams:s,...o}=u.current,c=(s||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),l=jt({...o,...e}),d=jt({...c,...n});o.id!==l.id&&(delete d.template,delete d.templateParams),l._searchParams=Object.entries(d).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const p=null!=r?r:d.preview===i.current.url;t(l,{replace:p})}),[t,i]),params:o,searchParams:l,structureParams:c}}function kt(e,t,n){var r,i;const o=a.useClient({apiVersion:l.A}),c=a.useActiveWorkspace(),u=(null==(r=null==c?void 0:c.activeWorkspace)?void 0:r.basePath)||"/",d=(null==(i=null==c?void 0:c.activeWorkspace)?void 0:i.name)||"default",p=function(e,t,n,r){const[i,o]=s.useState((()=>r||"")),c=s.useRef(0);s.useEffect((()=>{if(i&&r)return window.clearTimeout(c.current),()=>{c.current=window.setTimeout((()=>{o("")}),100)}}),[i,r]);const l=a.useCurrentUser();return s.useMemo((()=>["@sanity/presentation",t,n,e,null==l?void 0:l.id,St,i]),[t,null==l?void 0:l.id,e,n,i])}(t,u,d,n),f=function(e,t){const n=a.useClient({apiVersion:l.A}),r=a.useCurrentUser(),[i,o]=s.useState(""),c=e?x.suspend((async()=>await m.createPreviewSecret(n,"@sanity/presentation",typeof window>"u"?"":location.href,null==r?void 0:r.id)),[...t,i]):null;return s.useEffect((()=>{if(!c)return;const e=setTimeout((()=>{s.startTransition((()=>o(c.expiresAt.toString())))}),c.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[c]),(null==c?void 0:c.secret)||null}("object"==typeof e||"function"==typeof e,p);return x.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${u}/`)&&r.pathname!==u?r:t}const t=await("object"==typeof e?y.definePreviewUrl(e):e)({client:o,previewUrlSecret:f,previewSearchParam:n,referrer:typeof document>"u"?null:document.referrer,studioBasePath:u});return new URL(t,location.origin)}),[...p,f])}const St=Symbol();const Et=s.lazy((()=>Promise.resolve().then((function(){return require("./LoaderQueries.cjs")})))),Ct=s.lazy((()=>Promise.resolve().then((function(){return require("./PostMessageRefreshMutations.cjs")})))),It=c.styled(i.Flex)`
  overflow-x: auto;
`;exports.default=function(e){var t,c,u,d;const{previewUrl:p,components:f}=null!=(t=e.tool.options)?t:{},h=e.tool.name||l.D,{unstable_navigator:m}=f||{},{navigate:v,state:g}=o.useRouter(),y=a.useUnique(Object.fromEntries(g._searchParams||[])),x=kt(p||"/",h,y.preview||null),[b]=s.useState((()=>{var t;const n=null==(t=e.tool.options)?void 0:t.devMode;return"function"==typeof n?n():"boolean"==typeof n?n:typeof window<"u"&&"localhost"===window.location.hostname})),j=s.useMemo((()=>x.origin),[x.origin]),P=s.useRef(null),[k,S]=s.useState(),[E,C]=s.useState({}),I=s.useRef({title:void 0,url:void 0}),{navigate:T,params:R,searchParams:L,structureParams:_}=Pt({initialPreviewUrl:x,routerNavigate:v,routerState:g,routerSearchParams:y,frameStateRef:I}),z=s.useMemo((()=>re(T,50)),[T]),[M,O]=s.useReducer(Ge,{},tt),$=s.useMemo((()=>R.perspective?"published":"previewDrafts"),[R.perspective]),U=s.useMemo((()=>R.viewport?"mobile":"desktop"),[R.viewport]),[A,F]=function(e,t){if("published"!==e&&"previewDrafts"!==e)throw new Error(`Invalid perspective: ${e}`);const[n,r]=s.useState({}),[i,a]=s.useState({}),o=s.useRef(""),c=s.useCallback(((e,n,i=[])=>{const s=i.filter((e=>"_projectId"in e&&e._projectId?(vt||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),vt=!0),!1):e));("published"===n?r:a)((n=>{const r={};for(const e of s)r[e._id]=e;if(o.current!==t.current.url)return o.current=t.current.url,{[e]:r};const i=n[e];return w.default(i,r)?n:{...n,[e]:r}}))}),[t]);return[s.useMemo((()=>{const t=Object.values("published"===e?n:i).reduce(((e,t)=>(Object.values(t).forEach((t=>{e[t._id]=t})),e)),{});return Object.values(t)}),[e,i,n]),c]}($,I),B=a.useProjectId(),W=a.useDataset(),q=xt({resolvers:null==(u=null==(c=e.tool.options)?void 0:c.resolve)?void 0:u.mainDocuments,previewUrl:null==(d=e.tool.options)?void 0:d.previewUrl,path:R.preview,navigate:T}),[N,V]=s.useState("connecting"),[K,G]=s.useState("connecting"),[J,H]=s.useState("connecting"),[X]=s.useState((()=>new Set)),Z=s.useCallback((e=>{const t=window.open(e,"_blank");t&&X.add(t)}),[X]);s.useEffect((()=>{if(X.size&&k)for(const e of X)e&&"closed"in e&&!e.closed&&k.addSource(e)}),[k,X,X.size]);const Q=s.useRef($);s.useEffect((()=>{Q.current=$}),[$]),s.useEffect((()=>{var e;const t=null==(e=P.current)?void 0:e.contentWindow;if(!t)return;const n=function(e){const{destroy:t,send:n}=D(e),r=new Set,i=new WeakMap,s=new Set;return{destroy:()=>{t();for(const e of s)e()},send:(e,...t)=>{n(e,...t);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,...t)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=D({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(...e)=>{const[t]=e;if("preview-kit/documents"!==t&&"overlay/navigate"!==t&&"loader/documents"!==t)return n(...e)}:void 0}}))});s.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:t,targetOrigin:j,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:V,onEvent(e,t){if("visual-editing/focus"!==e&&"overlay/focus"!==e||!("id"in t))if("visual-editing/navigate"===e||"overlay/navigate"===e){const{title:e,url:n}=t;I.current.url!==n&&z({},{preview:n}),I.current={title:e,url:n}}else"visual-editing/meta"===e?I.current.title=t.title:"visual-editing/toggle"===e||"overlay/toggle"===e?O({type:Ke,enabled:t.enabled}):"visual-editing/documents"===e?F("visual-editing",t.perspective,t.documents):"visual-editing/refreshing"===e&&"manual"===t.source?clearTimeout(ge.current):"visual-editing/refreshing"===e&&"mutation"===t.source?O({type:Ne}):"visual-editing/refreshed"===e&&O({type:qe});else z({type:t.type,id:t.id,path:t.path},{prefersLatestPublished:"isDraft"in t||"previewDrafts"===Q.current?void 0:"true"})}},{id:"loaders",heartbeat:!0,onStatusUpdate:G,onEvent(e,t){if("loader/documents"===e&&t.projectId===B&&t.dataset===W)F("loaders",t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===B&&t.dataset===W){if("number"==typeof t.heartbeat&&t.heartbeat<l.c)throw new Error(`Loader query listen heartbeat interval must be at least ${l.c}ms`);C((e=>{var n;return{...e,[ee(t.query,t.params)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:null!=(n=t.heartbeat)&&n}}}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:H,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===B&&t.dataset===W&&F("preview-kit",t.perspective,t.documents)}}]});return S(n),()=>{n.destroy(),S(void 0)}}),[W,B,F,z,j]),s.useEffect((()=>{const e=setInterval((()=>C((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))),l.c);return()=>clearInterval(e)}),[]);const Y=s.useCallback((e=>{z({path:r.studioPath.toString(e)},{},!0)}),[z]),ie=s.useCallback((e=>{const t=new URL(e,x.origin),n=t.pathname+t.search;t.origin===x.origin&&n!==R.preview&&z({},{preview:n})}),[x,R,z]),se=s.useCallback((e=>{z({},{...e,prefersLatestPublished:void 0})}),[z]);s.useEffect((()=>{null==k||k.send("overlays","presentation/perspective",{perspective:$})}),[k,$]),s.useEffect((()=>{R.id&&R.path?null==k||k.send("overlays","presentation/focus",{id:R.id,path:R.path}):null==k||k.send("overlays","presentation/blur",void 0)}),[k,R.id,R.path]);const oe=s.useRef(void 0);s.useEffect((()=>{"published"===$&&R.id&&R.id!==oe.current&&!R.rev&&!R.prefersLatestPublished&&z({},{prefersLatestPublished:"true"},!0),oe.current=R.id}),[z,R.id,R.prefersLatestPublished,R.rev,$]),s.useEffect((()=>{I.current.url&&R.preview&&I.current.url!==R.preview&&(I.current.url=R.preview,"connected"!==N&&P.current?P.current.src=`${j}${R.preview}`:null==k||k.send("overlays","presentation/navigate",{url:R.preview,type:"replace"}))}),[k,N,j,R.preview]);const ce=s.useCallback((()=>null==k?void 0:k.send("overlays","presentation/toggleOverlay",void 0)),[k]),[le,ue]=s.useState(null);s.useEffect((()=>{const e=e=>{ne(e)&&ce()},t=e=>{var t;ne(e)&&ce(),t=e,["mod","\\"].every((e=>te[e]?t[te[e]]:t.key===e.toUpperCase()))&&ce()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ce]);const[de,pe]=s.useState(null),[{navigatorEnabled:fe,toggleNavigator:he},me]=Ae({unstable_navigator:m}),ve=s.useRef(R.id);s.useEffect((()=>{R.rev&&ve.current&&R.id!==ve.current&&z({},{rev:void 0}),ve.current=R.id}));const ge=s.useRef(),ye=s.useCallback((e=>{if(O({type:Ne}),k)return ge.current=window.setTimeout(e,300),void k.send("overlays","presentation/refresh",{source:"manual",livePreviewEnabled:"connected"===J||"connected"===K});e()}),[k,K,J]),be=a.useWorkspace(),we=s.useCallback((({id:e,type:t,path:n})=>{if(I.current.url)return{title:I.current.title||I.current.url,name:"edit",params:{id:e,path:n,type:t,inspect:l.C,workspace:be.name,mode:l.E,preview:R.preview}}}),[R.preview,be.name]),je=s.useCallback((e=>{z({},{viewport:"desktop"===e?void 0:"mobile"},!0)}),[z]),Pe=s.useCallback((e=>{z({},{perspective:"previewDrafts"===e?void 0:e})}),[z]);return n.jsxs(n.Fragment,{children:[n.jsx(We,{devMode:b,name:h,navigate:z,params:R,searchParams:L,structureParams:_,children:n.jsx(Ue,{navigate:z,children:n.jsx(Be,{params:R,children:n.jsx(It,{height:"fill",children:n.jsxs(xe,{children:[n.jsx(me,{}),n.jsx(ae,{id:"preview",minWidth:325,defaultSize:fe?50:75,order:3,children:n.jsx(i.Flex,{direction:"column",flex:1,height:"fill",ref:pe,children:n.jsx(i.BoundaryElementProvider,{element:de,children:n.jsx(dt,{dispatch:O,iframe:M.iframe,initialUrl:x,loadersConnection:K,navigatorEnabled:fe,onPathChange:ie,onRefresh:ye,openPopup:Z,overlaysConnection:N,previewUrl:R.preview,perspective:$,ref:P,setPerspective:Pe,setViewport:je,targetOrigin:j,toggleNavigator:he,toggleOverlay:ce,viewport:U,visualEditing:M.visualEditing})})})}),n.jsx($e,{documentId:R.id,documentsOnPage:A,documentType:R.type,getCommentIntent:we,mainDocumentState:q,onFocusPath:Y,onStructureParams:se,searchParams:L,setDisplayedDocument:ue,structureParams:_})]})})})})}),k&&n.jsx(s.Suspense,{children:n.jsx(Et,{channel:k,liveQueries:E,perspective:$,liveDocument:le,documentsOnPage:A})}),k&&R.id&&R.type&&n.jsx(s.Suspense,{children:n.jsx(Ct,{channel:k,id:R.id,type:R.type,loadersConnection:K,previewKitConnection:J})})]})};//# sourceMappingURL=PresentationTool.cjs.map
