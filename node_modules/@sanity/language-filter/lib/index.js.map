{"version":3,"file":"index.js","sources":["../src/filterField.ts","../src/useSelectedLanguageIds.ts","../src/LanguageFilterStudioContext.tsx","../src/usePaneLanguages.ts","../src/LanguageFilterMenuButton.tsx","../src/LanguageFilterObjectInput.tsx","../src/plugin.tsx"],"sourcesContent":["import type {SchemaType} from 'sanity'\n\nimport type {FilterFieldFunction, LanguageFilterConfig, LanguageFilterSchema} from './types'\n\nexport const defaultFilterField: FilterFieldFunction = (\n  enclosingType,\n  field,\n  selectedLanguageIds,\n) => !enclosingType.name.startsWith('locale') || selectedLanguageIds.includes(field.name)\n\nexport function isLanguageFilterEnabled(\n  schemaType: SchemaType | undefined,\n  options: LanguageFilterConfig,\n): boolean {\n  const schemaFilter =\n    isDocument(schemaType) && (schemaType as LanguageFilterSchema)?.options?.languageFilter\n  const defaultEnabled = !options.documentTypes\n\n  return !!(\n    (defaultEnabled && schemaFilter !== false) ||\n    (!defaultEnabled && schemaFilter) ||\n    (schemaType && options.documentTypes?.includes(schemaType.name))\n  )\n}\n\nfunction isDocument(schemaType?: SchemaType) {\n  return schemaType?.jsonType === 'object' && getRootType(schemaType).name === 'document'\n}\n\nfunction getRootType(schema: SchemaType): SchemaType {\n  if (schema.type) {\n    return getRootType(schema.type)\n  }\n  return schema\n}\n","import {useState} from 'react'\n\nimport type {Language, LanguageFilterConfig} from './types'\nconst storageKey = '@sanity/plugin/language-filter/selected-languages'\n\nexport function getPersistedLanguageIds(options: LanguageFilterConfig): string[] {\n  const selectableLangs = getSelectableLanguages(options).map((l) => l.id)\n\n  let selected: string[] = selectableLangs\n  try {\n    const persistedValue = window.localStorage.getItem(storageKey)\n    if (persistedValue) {\n      selected = JSON.parse(persistedValue)\n    }\n  } catch (err) {} // eslint-disable-line no-empty\n\n  // constrain persisted/selected languages to the ones currently supported\n  selected = intersection(selected, selectableLangs)\n  return selected\n}\n\nexport function persistLanguageIds(languageIds: string[]): void {\n  window.localStorage.setItem(storageKey, JSON.stringify(languageIds))\n}\n\nfunction intersection(array1: string[], array2: string[]) {\n  return array1.filter((value) => array2.includes(value))\n}\n\nexport function getSelectableLanguages({\n  supportedLanguages,\n  defaultLanguages,\n}: LanguageFilterConfig): Language[] {\n  return Array.isArray(supportedLanguages)\n    ? supportedLanguages.filter((lang) => !defaultLanguages?.includes(lang.id))\n    : []\n}\n\nexport function useSelectedLanguageIds(\n  options: LanguageFilterConfig,\n): [string[], (ids: string[]) => void] {\n  return useState(() => [...(options.defaultLanguages ?? []), ...getPersistedLanguageIds(options)])\n}\n","import {createContext, useContext, useEffect, useMemo, useState} from 'react'\nimport {type LayoutProps, useClient} from 'sanity'\n\nimport {defaultFilterField} from './filterField'\nimport type {\n  Language,\n  LanguageCallback,\n  LanguageFilterConfig,\n  LanguageFilterConfigProcessed,\n} from './types'\nimport {useSelectedLanguageIds} from './useSelectedLanguageIds'\n\nexport interface LanguageFilterStudioContextProps {\n  // eslint-disable-next-line react/require-default-props\n  options: Required<LanguageFilterConfig>\n}\n\nexport interface LanguageFilterStudioContextProcessed {\n  options: Required<LanguageFilterConfigProcessed>\n}\n\nexport interface LanguageFilterStudioContextValue extends LanguageFilterStudioContextProcessed {\n  selectedLanguageIds: string[]\n  setSelectedLanguageIds: (ids: string[]) => void\n}\n\nexport const defaultContextValue: LanguageFilterStudioContextValue = {\n  options: {\n    apiVersion: '2022-11-27',\n    supportedLanguages: [],\n    defaultLanguages: [],\n    documentTypes: [],\n    filterField: defaultFilterField,\n  },\n  selectedLanguageIds: [],\n  setSelectedLanguageIds: () => console.error('LanguageFilterStudioContext not initialized'),\n}\n\nconst LanguageFilterStudioContext =\n  createContext<LanguageFilterStudioContextValue>(defaultContextValue)\n\n/**\n * This is a separate Provider from the Context that wraps the document pane\n * but it used to listen to changes to the selected language IDs inside it\n * and provide them to a Studio-wide context\n */\nexport function LanguageFilterStudioProvider(\n  props: LayoutProps & LanguageFilterStudioContextProps,\n) {\n  const client = useClient({apiVersion: '2023-01-01'})\n  const [languages, setLanguages] = useState<Language[]>(\n    Array.isArray(props.options.supportedLanguages) ? props.options.supportedLanguages : [],\n  )\n  useEffect(() => {\n    let asyncLanguages: Language[] = []\n\n    async function getLanguages(supportedLanguagesCallback: LanguageCallback) {\n      asyncLanguages = await supportedLanguagesCallback(client, {})\n      setLanguages(asyncLanguages)\n    }\n\n    if (!Array.isArray(props.options.supportedLanguages)) {\n      getLanguages(props.options.supportedLanguages)\n    }\n  }, [client, props.options.supportedLanguages])\n\n  const options = useMemo<Required<LanguageFilterConfigProcessed>>(() => {\n    return {\n      ...defaultContextValue.options,\n      ...props.options,\n      supportedLanguages: languages,\n    }\n  }, [props.options, languages])\n\n  const [selectedLanguageIds, setSelectedLanguageIds] = useSelectedLanguageIds(options)\n\n  return (\n    <LanguageFilterStudioContext.Provider\n      value={{options, selectedLanguageIds, setSelectedLanguageIds}}\n    >\n      {props.renderDefault(props)}\n    </LanguageFilterStudioContext.Provider>\n  )\n}\n\n/**\n * Retrieves plugin options and the currently selected\n * language IDs from anywhere in the Studio\n */\nexport function useLanguageFilterStudioContext() {\n  return useContext(LanguageFilterStudioContext)\n}\n","import {useCallback, useMemo} from 'react'\n\nimport {useLanguageFilterStudioContext} from './LanguageFilterStudioContext'\nimport {getSelectableLanguages, persistLanguageIds} from './useSelectedLanguageIds'\n\nconst unique = (arr: string[]) => Array.from(new Set(arr))\n\nexport function usePaneLanguages(): {\n  activeLanguages: string[]\n  allSelected: boolean\n  selectAll: () => void\n  selectNone: () => void\n  toggleLanguage: (languageId: string) => void\n} {\n  const {selectedLanguageIds, setSelectedLanguageIds, options} = useLanguageFilterStudioContext()\n  const {defaultLanguages = []} = options\n\n  const selectableLanguages = useMemo(() => getSelectableLanguages(options), [options])\n\n  const updateSelectedIds = useCallback(\n    (ids: string[]) => {\n      setSelectedLanguageIds(unique([...defaultLanguages, ...ids]))\n      persistLanguageIds(unique([...defaultLanguages, ...ids]))\n    },\n    [defaultLanguages, setSelectedLanguageIds],\n  )\n\n  const selectAll = useCallback(\n    () => updateSelectedIds(selectableLanguages.map((l) => l.id)),\n    [updateSelectedIds, selectableLanguages],\n  )\n\n  const selectNone = useCallback(() => {\n    updateSelectedIds(defaultLanguages)\n  }, [defaultLanguages, updateSelectedIds])\n\n  const toggleLanguage = useCallback(\n    (languageId: string) => {\n      let lang = selectedLanguageIds\n\n      if (lang.includes(languageId)) {\n        lang = lang.filter((l) => l !== languageId)\n      } else {\n        lang = unique([...lang, languageId])\n      }\n\n      updateSelectedIds(lang)\n    },\n    [updateSelectedIds, selectedLanguageIds],\n  )\n\n  const activeLanguages = useMemo(\n    () => unique([...(defaultLanguages ?? []), ...selectedLanguageIds]),\n    [defaultLanguages, selectedLanguageIds],\n  )\n\n  return {\n    activeLanguages,\n    allSelected:\n      selectedLanguageIds.length === selectableLanguages.length + defaultLanguages.length,\n    selectAll,\n    selectNone,\n    toggleLanguage,\n  }\n}\n","import {\n  CheckmarkCircleIcon,\n  CircleIcon,\n  EyeClosedIcon,\n  EyeOpenIcon,\n  TranslateIcon,\n} from '@sanity/icons'\nimport {\n  Badge,\n  Box,\n  Button,\n  Card,\n  Flex,\n  Popover,\n  Stack,\n  Text,\n  TextInput,\n  useClickOutside,\n} from '@sanity/ui'\nimport {type FormEvent, type MouseEventHandler, useCallback, useState} from 'react'\nimport {TextWithTone} from 'sanity'\nimport {styled} from 'styled-components'\n\nimport {useLanguageFilterStudioContext} from './LanguageFilterStudioContext'\nimport {usePaneLanguages} from './usePaneLanguages'\n\nconst StyledBox = styled(Box)`\n  max-height: calc(100vh - 200px);\n`\n\nexport function LanguageFilterMenuButton() {\n  const {options} = useLanguageFilterStudioContext()\n\n  const defaultLanguages = options.supportedLanguages.filter((l) =>\n    options.defaultLanguages?.includes(l.id),\n  )\n\n  const languageOptions = options.supportedLanguages.filter(\n    (l) => !options.defaultLanguages?.includes(l.id),\n  )\n  const [open, setOpen] = useState(false)\n  const {activeLanguages, allSelected, selectAll, selectNone, toggleLanguage} = usePaneLanguages()\n  const [button, setButton] = useState<HTMLElement | null>(null)\n  const [popover, setPopover] = useState<HTMLElement | null>(null)\n\n  const handleToggleAll: MouseEventHandler<HTMLButtonElement> = useCallback(\n    (event) => {\n      const checked = event.currentTarget.value === 'ALL'\n\n      if (checked) {\n        selectAll()\n      } else {\n        selectNone()\n      }\n    },\n    [selectAll, selectNone],\n  )\n\n  const handleClick = useCallback(() => setOpen((o) => !o), [])\n\n  const handleClickOutside = useCallback(() => setOpen(false), [])\n\n  useClickOutside(handleClickOutside, [button, popover])\n\n  const langCount = options.supportedLanguages.length\n\n  // Search filter query\n  const [query, setQuery] = useState('')\n  const handleQuery = useCallback((event: FormEvent<HTMLInputElement>) => {\n    if (event.currentTarget.value) {\n      setQuery(event.currentTarget.value)\n    } else {\n      setQuery('')\n    }\n  }, [])\n\n  const showSearch = langCount > 4\n\n  const content = (\n    <StyledBox overflow=\"auto\">\n      <Stack padding={1} space={1}>\n        {defaultLanguages.length > 0 && (\n          <>\n            {defaultLanguages.map((l) => (\n              <LanguageFilterOption key={l.id} id={l.id} title={l.title} selected />\n            ))}\n            <Card borderTop />\n          </>\n        )}\n\n        <Button\n          mode=\"bleed\"\n          onClick={handleToggleAll}\n          justify=\"flex-start\"\n          value={allSelected ? 'NONE' : 'ALL'}\n          disabled={!!query}\n        >\n          <Flex gap={3} align=\"center\">\n            <Text size={2}>\n              {allSelected ? (\n                <TextWithTone tone=\"primary\">\n                  <EyeClosedIcon />\n                </TextWithTone>\n              ) : (\n                <EyeOpenIcon />\n              )}\n            </Text>\n            <Box flex={1}>\n              <Text>{allSelected ? 'Hide all' : 'Show all'}</Text>\n            </Box>\n          </Flex>\n        </Button>\n\n        {showSearch ? (\n          <TextInput onChange={handleQuery} value={query} placeholder=\"Filter languages\" />\n        ) : (\n          <Card borderTop />\n        )}\n\n        {languageOptions\n          .filter((language) => {\n            if (query) {\n              return language.title.toLowerCase().includes(query.toLowerCase())\n            }\n            return true\n          })\n          .map((lang) => (\n            <LanguageFilterOption\n              id={lang.id}\n              key={lang.id}\n              onToggle={toggleLanguage}\n              selected={activeLanguages.includes(lang.id)}\n              title={lang.title}\n            />\n          ))}\n      </Stack>\n    </StyledBox>\n  )\n\n  const buttonText =\n    activeLanguages.length === langCount\n      ? 'Showing all'\n      : `Showing ${activeLanguages.length} / ${langCount}`\n  return (\n    <Popover animate content={content} open={open} portal ref={setPopover}>\n      <Button\n        text={buttonText}\n        icon={TranslateIcon}\n        mode=\"bleed\"\n        onClick={handleClick}\n        ref={setButton}\n        selected={open}\n      />\n    </Popover>\n  )\n}\n\nfunction LanguageFilterOption(props: {\n  id: string\n  selected: boolean\n  title: string\n  // eslint-disable-next-line react/require-default-props\n  onToggle?: (id: string) => void\n}) {\n  const {id, onToggle, selected, title} = props\n\n  const handleChange = useCallback(() => {\n    if (onToggle) {\n      onToggle(id)\n    }\n  }, [id, onToggle])\n\n  const disabled = !onToggle\n\n  return (\n    <Button mode=\"bleed\" onClick={handleChange} justify=\"flex-start\" disabled={disabled}>\n      <Flex gap={3} align=\"center\">\n        <Text size={2}>\n          {selected ? (\n            <TextWithTone tone={disabled ? 'default' : 'positive'}>\n              <CheckmarkCircleIcon />\n            </TextWithTone>\n          ) : (\n            <CircleIcon />\n          )}\n        </Text>\n        <Box flex={1}>\n          <Text>{title}</Text>\n        </Box>\n        <Badge>{id}</Badge>\n      </Flex>\n    </Button>\n  )\n}\n","import {useMemo} from 'react'\nimport {type ObjectInputProps, type ObjectMember, useFormValue, useSchema} from 'sanity'\n\nimport {isLanguageFilterEnabled} from './filterField'\nimport {useLanguageFilterStudioContext} from './LanguageFilterStudioContext'\n\n// First check that this Object is in a schema type for which language-filter is enabled\nexport function FilteredObjectWrapper(props: ObjectInputProps) {\n  const {options} = useLanguageFilterStudioContext()\n\n  const documentType = useFormValue(['_type']) as string\n  const schema = useSchema()\n  const languageFilterEnabled = isLanguageFilterEnabled(schema.get(documentType), options)\n  return languageFilterEnabled ? <FilteredObjectInput {...props} /> : props.renderDefault(props)\n}\n\n// Modify the object members based on selected languages in the filter\nexport function FilteredObjectInput(props: ObjectInputProps) {\n  const {members: membersProp, schemaType, renderDefault, ...restProps} = props\n  const {selectedLanguageIds, options} = useLanguageFilterStudioContext()\n  const {filterField} = options\n\n  const members: ObjectMember[] = useMemo(() => {\n    return membersProp\n      .filter((member) => {\n        return (\n          (member.kind === 'field' && filterField(schemaType, member, selectedLanguageIds)) ||\n          member.kind === 'fieldSet'\n        )\n      })\n      .map((member) => {\n        if (member.kind === 'fieldSet') {\n          return {\n            ...member,\n            fieldSet: {\n              ...member.fieldSet,\n              members: member.fieldSet.members.filter((fieldsetMember) => {\n                return (\n                  fieldsetMember.kind === 'field' &&\n                  filterField(schemaType, fieldsetMember, selectedLanguageIds)\n                )\n              }),\n            },\n          }\n        }\n        return member\n      })\n  }, [schemaType, membersProp, filterField, selectedLanguageIds])\n\n  return renderDefault({...restProps, members, schemaType, renderDefault})\n}\n","import {\n  definePlugin,\n  type DocumentLanguageFilterComponent,\n  isObjectSchemaType,\n  type ObjectInputProps,\n} from 'sanity'\n\nimport {isLanguageFilterEnabled} from './filterField'\nimport {LanguageFilterMenuButton} from './LanguageFilterMenuButton'\nimport {FilteredObjectWrapper} from './LanguageFilterObjectInput'\nimport {defaultContextValue, LanguageFilterStudioProvider} from './LanguageFilterStudioContext'\nimport type {LanguageFilterConfig} from './types'\n\n/**\n * ## Usage in sanity.config.ts (or .js)\n *\n * ```\n * import {defineConfig} from 'sanity'\n * import {languageFilter} from '@sanity/language-filter'\n *\n * export const defineConfig({\n *     /...\n *     plugins: [\n *         languageFilter({\n *             supportedLanguages: [\n *               {id: 'nb', title: 'Norwegian (Bokmål)'},\n *               {id: 'nn', title: 'Norwegian (Nynorsk)'},\n *               {id: 'en', title: 'English'},\n *               {id: 'es', title: 'Spanish'},\n *               {id: 'arb', title: 'Arabic'},\n *               {id: 'pt', title: 'Portuguese'},\n *               //...\n *             ],\n *             // Select Norwegian (Bokmål) by default\n *             defaultLanguages: ['nb'],\n *             // Only show language filter for document type `page` (schemaType.name)\n *             // Can also enable via document-options: options.languageFilter: true\n *             documentTypes: ['page'],\n *             // default filter function shown\n *             filterField: (enclosingType, field, selectedLanguageIds) =>\n *               !enclosingType.name.startsWith('locale') || selectedLanguageIds.includes(field.name),\n *        })\n *    ]\n * })\n * ```\n */\nexport const languageFilter = definePlugin<LanguageFilterConfig>((options) => {\n  const RenderLanguageFilter: DocumentLanguageFilterComponent = () => {\n    return <LanguageFilterMenuButton />\n  }\n\n  const pluginOptions = {\n    ...defaultContextValue.options,\n    ...options,\n  }\n\n  return {\n    name: '@sanity/language-filter',\n    studio: {\n      components: {\n        layout: (props) => LanguageFilterStudioProvider({...props, options: pluginOptions}),\n      },\n    },\n\n    document: {\n      unstable_languageFilter: (prev, {schemaType, schema}) => {\n        if (isLanguageFilterEnabled(schema.get(schemaType), options)) {\n          return [...prev, RenderLanguageFilter]\n        }\n        return prev\n      },\n    },\n\n    form: {\n      components: {\n        input: (props) => {\n          if (props.id !== 'root' && isObjectSchemaType(props.schemaType)) {\n            return FilteredObjectWrapper(props as ObjectInputProps)\n          }\n\n          return props.renderDefault(props)\n        },\n      },\n    },\n  }\n})\n"],"names":["defaultFilterField","enclosingType","field","selectedLanguageIds","name","startsWith","includes","isLanguageFilterEnabled","schemaType","options","_a","_b","schemaFilter","jsonType","getRootType","isDocument","languageFilter","defaultEnabled","documentTypes","schema","type","storageKey","getPersistedLanguageIds","selectableLangs","getSelectableLanguages","map","l","id","selected","persistedValue","window","localStorage","getItem","JSON","parse","array2","filter","value","supportedLanguages","defaultLanguages","Array","isArray","lang","defaultContextValue","apiVersion","filterField","setSelectedLanguageIds","console","error","LanguageFilterStudioContext","createContext","LanguageFilterStudioProvider","props","client","useClient","languages","setLanguages","useState","useEffect","asyncLanguages","async","supportedLanguagesCallback","getLanguages","useMemo","useSelectedLanguageIds","jsxRuntime","jsx","Provider","children","renderDefault","useLanguageFilterStudioContext","useContext","unique","arr","from","Set","usePaneLanguages","selectableLanguages","updateSelectedIds","useCallback","ids","languageIds","setItem","stringify","selectAll","selectNone","toggleLanguage","languageId","activeLanguages","allSelected","length","StyledBox","styled","Box","LanguageFilterMenuButton","languageOptions","open","setOpen","button","setButton","popover","setPopover","handleToggleAll","event","currentTarget","handleClick","o","handleClickOutside","useClickOutside","langCount","query","setQuery","handleQuery","showSearch","content","overflow","jsxs","Stack","padding","space","Fragment","LanguageFilterOption","title","Card","borderTop","Button","mode","onClick","justify","disabled","Flex","gap","align","Text","size","TextWithTone","tone","EyeClosedIcon","EyeOpenIcon","flex","TextInput","onChange","placeholder","language","toLowerCase","onToggle","buttonText","Popover","animate","portal","ref","text","icon","TranslateIcon","handleChange","CheckmarkCircleIcon","CircleIcon","Badge","FilteredObjectInput","members","membersProp","restProps","member","kind","fieldSet","fieldsetMember","definePlugin","RenderLanguageFilter","pluginOptions","studio","components","layout","document","unstable_languageFilter","prev","get","form","input","isObjectSchemaType","documentType","useFormValue","useSchema","FilteredObjectWrapper","exports"],"mappings":"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"}