import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{useState as l,createContext as r,useEffect as a,useMemo as i,useContext as o,useCallback as s}from"react";import{useClient as u,TextWithTone as d,useFormValue as c,useSchema as g,definePlugin as p,isObjectSchemaType as f}from"sanity";import{EyeClosedIcon as m,EyeOpenIcon as h,TranslateIcon as L,CheckmarkCircleIcon as y,CircleIcon as v}from"@sanity/icons";import{Box as S,useClickOutside as T,Stack as b,Card as w,Button as A,Flex as x,Text as I,TextInput as k,Popover as C,Badge as F}from"@sanity/ui";import{styled as N}from"styled-components";const j=(e,t,n)=>!e.name.startsWith("locale")||n.includes(t.name);function D(e,t){var n,l;const r=function(e){return"object"===(null==e?void 0:e.jsonType)&&"document"===z(e).name}(e)&&(null==(n=null==e?void 0:e.options)?void 0:n.languageFilter),a=!t.documentTypes;return!!(a&&!1!==r||!a&&r||e&&null!=(l=t.documentTypes)&&l.includes(e.name))}function z(e){return e.type?z(e.type):e}const O="@sanity/plugin/language-filter/selected-languages";function J(e){const t=V(e).map((e=>e.id));let n=t;try{const e=window.localStorage.getItem(O);e&&(n=JSON.parse(e))}catch{}return l=t,n=n.filter((e=>l.includes(e))),n;var l}function V({supportedLanguages:e,defaultLanguages:t}){return Array.isArray(e)?e.filter((e=>!(null!=t&&t.includes(e.id)))):[]}const $={options:{apiVersion:"2022-11-27",supportedLanguages:[],defaultLanguages:[],documentTypes:[],filterField:j},selectedLanguageIds:[],setSelectedLanguageIds:()=>console.error("LanguageFilterStudioContext not initialized")},_=r($);function E(t){const n=u({apiVersion:"2023-01-01"}),[r,o]=l(Array.isArray(t.options.supportedLanguages)?t.options.supportedLanguages:[]);a((()=>{let e=[];Array.isArray(t.options.supportedLanguages)||async function(t){e=await t(n,{}),o(e)}(t.options.supportedLanguages)}),[n,t.options.supportedLanguages]);const s=i((()=>({...$.options,...t.options,supportedLanguages:r})),[t.options,r]),[d,c]=function(e){return l((()=>{var t;return[...null!=(t=e.defaultLanguages)?t:[],...J(e)]}))}(s);return e(_.Provider,{value:{options:s,selectedLanguageIds:d,setSelectedLanguageIds:c},children:t.renderDefault(t)})}function H(){return o(_)}const P=e=>Array.from(new Set(e));function W(){const{selectedLanguageIds:e,setSelectedLanguageIds:t,options:n}=H(),{defaultLanguages:l=[]}=n,r=i((()=>V(n)),[n]),a=s((e=>{var n;t(P([...l,...e])),n=P([...l,...e]),window.localStorage.setItem(O,JSON.stringify(n))}),[l,t]),o=s((()=>a(r.map((e=>e.id)))),[a,r]),u=s((()=>{a(l)}),[l,a]),d=s((t=>{let n=e;n=n.includes(t)?n.filter((e=>e!==t)):P([...n,t]),a(n)}),[a,e]);return{activeLanguages:i((()=>P([...null!=l?l:[],...e])),[l,e]),allSelected:e.length===r.length+l.length,selectAll:o,selectNone:u,toggleLanguage:d}}const q=N(S)`
  max-height: calc(100vh - 200px);
`;function B(){const{options:r}=H(),a=r.supportedLanguages.filter((e=>{var t;return null==(t=r.defaultLanguages)?void 0:t.includes(e.id)})),i=r.supportedLanguages.filter((e=>{var t;return!(null!=(t=r.defaultLanguages)&&t.includes(e.id))})),[o,u]=l(!1),{activeLanguages:c,allSelected:g,selectAll:p,selectNone:f,toggleLanguage:y}=W(),[v,F]=l(null),[N,j]=l(null),D=s((e=>{"ALL"===e.currentTarget.value?p():f()}),[p,f]),z=s((()=>u((e=>!e))),[]),O=s((()=>u(!1)),[]);T(O,[v,N]);const J=r.supportedLanguages.length,[V,$]=l(""),_=s((e=>{e.currentTarget.value?$(e.currentTarget.value):$("")}),[]),E=J>4,P=e(q,{overflow:"auto",children:t(b,{padding:1,space:1,children:[a.length>0&&t(n,{children:[a.map((t=>e(G,{id:t.id,title:t.title,selected:!0},t.id))),e(w,{borderTop:!0})]}),e(A,{mode:"bleed",onClick:D,justify:"flex-start",value:g?"NONE":"ALL",disabled:!!V,children:t(x,{gap:3,align:"center",children:[e(I,{size:2,children:g?e(d,{tone:"primary",children:e(m,{})}):e(h,{})}),e(S,{flex:1,children:e(I,{children:g?"Hide all":"Show all"})})]})}),E?e(k,{onChange:_,value:V,placeholder:"Filter languages"}):e(w,{borderTop:!0}),i.filter((e=>!V||e.title.toLowerCase().includes(V.toLowerCase()))).map((t=>e(G,{id:t.id,onToggle:y,selected:c.includes(t.id),title:t.title},t.id)))]})}),B=c.length===J?"Showing all":`Showing ${c.length} / ${J}`;return e(C,{animate:!0,content:P,open:o,portal:!0,ref:j,children:e(A,{text:B,icon:L,mode:"bleed",onClick:z,ref:F,selected:o})})}function G(n){const{id:l,onToggle:r,selected:a,title:i}=n,o=s((()=>{r&&r(l)}),[l,r]),u=!r;return e(A,{mode:"bleed",onClick:o,justify:"flex-start",disabled:u,children:t(x,{gap:3,align:"center",children:[e(I,{size:2,children:a?e(d,{tone:u?"default":"positive",children:e(y,{})}):e(v,{})}),e(S,{flex:1,children:e(I,{children:i})}),e(F,{children:l})]})})}function K(e){const{members:t,schemaType:n,renderDefault:l,...r}=e,{selectedLanguageIds:a,options:o}=H(),{filterField:s}=o;return l({...r,members:i((()=>t.filter((e=>"field"===e.kind&&s(n,e,a)||"fieldSet"===e.kind)).map((e=>"fieldSet"===e.kind?{...e,fieldSet:{...e.fieldSet,members:e.fieldSet.members.filter((e=>"field"===e.kind&&s(n,e,a)))}}:e))),[n,t,s,a]),schemaType:n,renderDefault:l})}const M=p((t=>{const n=()=>e(B,{}),l={...$.options,...t};return{name:"@sanity/language-filter",studio:{components:{layout:e=>E({...e,options:l})}},document:{unstable_languageFilter:(e,{schemaType:l,schema:r})=>D(r.get(l),t)?[...e,n]:e},form:{components:{input:t=>"root"!==t.id&&f(t.schemaType)?function(t){const{options:n}=H(),l=c(["_type"]);return D(g().get(l),n)?e(K,{...t}):t.renderDefault(t)}(t):t.renderDefault(t)}}}}));export{j as defaultFilterField,D as isLanguageFilterEnabled,M as languageFilter,H as useLanguageFilterStudioContext};//# sourceMappingURL=index.mjs.map
